



----Law Extracted size
SELECT CAST(CAST(SUM(CAST(filesize AS NUMERIC))/1024/1024/1024 AS NUMERIC(18,3)) AS VARCHAR)
+ ' GB' FROM tbldoc
WHERE (srm_exportvolume = 'BH045024' AND id = attachpid)
OR (srm_exportvolume = 'BH045024' AND attachpid = 0)


----Law Counts
select srm_wave, srm_exportvolume, count(*) from tbldoc
group by srm_wave, srm_exportvolume

select count(*) from tbldoc
where srm_exportvolume = 'VOF-N-EREV004'

select count(*) from tblpage
inner join tbldoc on tblpage.id = tbldoc.id
where srm_exportvolume = 'VOF-N-EREV004'

select min(begdoc#), max(enddoc#) from tbldoc
where srm_exportvolume = 'VOF-N-EREV004'

select name, custodianid, count(*) as 'count' from tbldoc
inner join tblcustodians on custodianid = tblcustodians.id
where srm_exportvolume = 'VOF-N-EREV004'
group by name, custodianid
order by name, custodianid



; With CTE as (
select id,AttachPID from tbldoc  where srm_wave = 'ATest001' and attachpid = 0
union all
select b.id,b.AttachPID  from tbldoc a
inner join tbldoc b on a.id = b.attachpid
where a.srm_wave = 'ATest001' and a.attachpid <> 0
)

select * from cte 
order by attachpid , id 



--select * from dbo.Project
--where ProjectName like '%ims%'

use P00194_Review


Declare @View int 
set @View = 49
 
 ;WITH cte
     AS (SELECT b.custodianid,b.FirstName,
                Folder = 'Natives',
                SizeInB = Sum(edfs_orifilesize),
                SizeInKB = Sum(Cast(Round(( Cast(edfs_orifilesize AS
                                                 NUMERIC(15, 4))
                                            /
                                            1024 ), 3
                                    ) AS
                                                   DECIMAL(10, 3))),
                SizeInMB = Sum(Cast(Round(( Cast(edfs_orifilesize AS
                                                 NUMERIC(15, 4))
                                            /
                                            1024 /
                                            1024 ), 3) AS
                                                   DECIMAL(
                                                   10, 3)))
         FROM   dbo.reviewedoc A WITH(nolock)
                INNER JOIN dbo.custodian B WITH(nolock)
                        ON a.c_custodianid = b.custodianid     
                inner join dbo.UserViewDoc C with(nolock)
						on a.DocID = c.DocID
				inner join dbo.UserViewHeader D with(nolock)
						on c.UVID = d.UVID 		                 
         WHERE  a.docid = a.ed_basedocid
         and c.UVID = @View 
         GROUP  BY b.custodianid,FirstName)
SELECT a.custodianid,
       Custodian = FirstName,
       folder,
       c.filecount,
       sizeinb,
       sizeinkb,
       sizeinmb,
       [SizeInMB(Email&Att)]
--INTO  ##vwdirectory3              
FROM   cte a
       INNER JOIN (SELECT a.c_custodianid,
                          FileCount = Count(*),
                          'SizeInMB(Email&Att)' = Sum(Cast(
                          Round(( Cast(edfs_orifilesize
                                       AS NUMERIC(
                                       15, 4))
                                  / 1024 / 1024 ), 3) AS
                                                    DECIMAL(
                                                    10, 3)))
                   FROM   dbo.reviewedoc a WITH(nolock)
                          INNER JOIN dbo.custodian b WITH(nolock)
                                  ON a.c_custodianid = b.custodianid
                          inner join dbo.UserViewDoc C with(nolock)
						on a.DocID = c.DocID
						 inner join dbo.UserViewHeader D with(nolock)
						on c.UVID = d.UVID  and c.UVID = @View 		                         										                                    
                   GROUP  BY a.c_custodianid) C
               ON a.custodianid = c. c_custodianid 