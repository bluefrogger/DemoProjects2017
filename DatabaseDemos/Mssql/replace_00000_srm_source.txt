
select tiffstatus, ocrstatus, COUNT(*)
from tblDoc
where (SRM_Exclude is null or SRM_Exclude = 0)
and ([SRM_Error Status] is null or [SRM_Error Status] = 0)
and SourceApp = 'image printer'
group by TiffStatus, ocrstatus



select docext, tiffstatus, ocrstatus, COUNT(*)
from tblDoc
where (SRM_Exclude is null or SRM_Exclude = 0)
and ([SRM_Error Status] is null or [SRM_Error Status] = 0)
and (DocExt like 'tif%' or DocExt like '%jp' or DocExt = 'bmp' or DocExt = 'gif' or DocExt = 'png')
group by docext, TiffStatus, ocrstatus


--- Numbering Check


select begdoc#
from tbldoc inner join tblPage
on tbldoc.id = tblpage.id
where dbo.tblDoc.srm_exportvolume like '%CL003%' and uid is null



----- Endorsement check

select begdoc#
from tbldoc inner join tblPage
on tbldoc.ID = tblpage.ID
where footer = 0 and dbo.tblDoc.srm_exportvolume like '%WPLV005%'
group by begdoc#



---- Page count match

select tblDoc.begdoc#, pgcount, count(pkey), CountMatch = 
case (pgCount - count(pkey))
WHEN 0 then 'Match'
ELSE 'Do Not Match'
END
from tblDoc inner join tblPage on tblDoc.ID = tblpage.id
where dbo.tblDoc.srm_exportvolume like '%CL003%'
group by tblDoc.begdoc#, pgCount
order by tblDoc.begdoc#



Show alls


select tblDoc.BegDoc#, pgcount, count(pkey), CountMatch = 
case (pgCount - count(pkey))
WHEN 0 then 'Match'
ELSE 'Do Not Match'
END
from tblDoc inner join tblPage on tblDoc.ID = tblpage.id
where FM103012_Taglist =1
group by tblDoc.BegDoc#, pgCount
order by tblDoc.BegDoc#



Shows just errors

SELECT tblDoc.BegDoc#, PgCount, ImagesCount = count(pkey)
FROM tblDoc inner join tblPage on tblDoc.ID = tblpage.id
WHERE BH045030_Taglist =1
GROUP by tblDoc.BegDoc#, pgCount
HAVING (pgCount - count(pkey)) <> 0  
ORDER BY tblDoc.BegDoc#


select begdoc#
from tbldoc inner join tblPage
on tbldoc.id = tblpage.id
where dbo.tblDoc.srm_wave like '%ms079002%' and uid is not null

--- Numbering Check


select begdoc#
from tbldoc inner join tblPage
on tbldoc.ID = tblpage.ID
where footer = 0 and dbo.tblDoc.srm_wave like '%ms079002%'
group by begdoc#

----- Endorsement check


select tblDoc.begdoc#, pgcount, count(pkey), CountMatch = 
case (pgCount - count(pkey))
WHEN 0 then 'Match'
ELSE 'Do Not Match'
END
from tblDoc inner join tblPage on tblDoc.ID = tblpage.id
where dbo.tblDoc.srm_wave like '%pkb044004%'
group by tblDoc.begdoc#, pgCount
order by tblDoc.begdoc#

---- Page count matchQueri


-- Update begDoc /endDoc for docs with pgCount = 1 --------------
update tblDoc
set begDoc# = replace(begdoc#,'_00001',''), enddoc# = replace(enddoc#,'_00001','')
--select begDoc#, endDoc# , begDoc# = replace(begdoc#,'_00001',''), enddoc# = replace(enddoc#,'_00001','')
--from tblDoc
where srm_exportvolume='CQG121' and pgCount = 1

-- Update begDoc for the docs with pgCount >1 -----------

update tblDoc
set begDoc# = replace(begDoc#,'_00001','')
--select begDoc#, begDoc# = replace(begDoc#,'_00001','')
--from tblDoc
Where srm_exportvolume='CQG121' and pgCount<>1


-- Update UID -----------
--
Update tblPage set UID = replace(UID,'_00001','')
from tblPage
INNER JOIN tblDoc on tblPage.id = tblDoc.id
--select uid, replace(UID,'_00001',''), dbo.tblDoc.PgCount
--from tblPage inner join tbldoc on tblpage.id = tbldoc.id
Where srm_exportvolume='CQG121'

select begDoc#, endDoc# , substring(begDoc#,0,len(begDoc#)-charindex('.',reverse(begDoc#))+1),
substring(endDoc#,0,len(endDoc#)-charindex('.',reverse(endDoc#))+1)+substring(endDoc#,len(endDoc#)-charindex('_',reverse(endDoc#))+1,len(endDoc#)-1)
--begDoc# = replace(begdoc#,'_00001',''), enddoc# = replace(enddoc#,'_00001','')
from tblDoc
where srm_exportvolume='CQG121'
--and pgCount = 1


update tblPage set uid=substring(uid,0,len(uid)-charindex('.',reverse(uid))+1)+substring(uid,len(uid)-charindex('_',reverse(uid))+1,len(uid)-1)
--from tblPage
--INNER JOIN tblDoc on tblPage.id = tblDoc.id
--select uid, replace(UID,'_00001','')
from tblPage inner join tbldoc on tblpage.id = tbldoc.id
Where srm_exportvolume='CQG121'

-- Update begDoc /endDoc for docs with pgCount = 1 --------------
--update tblDoc
--set begDoc# = replace(begdoc#,'_00001',''), enddoc# = replace(enddoc#,'_00001','')
select begDoc#, endDoc# , begDoc# = replace(begdoc#,'_00001',''), enddoc# = replace(enddoc#,'_00001','')
from tblDoc
where srm_exportvolume='CQG121' and pgCount = 1

-- Update begDoc for the docs with pgCount >1 -----------

--update tblDoc
--set begDoc# = replace(begDoc#,'_00001','')
select begDoc#, begDoc# = replace(begDoc#,'_00001','')
from tblDoc
Where srm_exportvolume='CQG121' and pgCount<>1


-- Update UID -----------
--
--Update tblPage set UID = replace(UID,'_00001',''), dbo.tblDoc.PgCount
--from tblPage
--INNER JOIN tblDoc on tblPage.id = tblDoc.id
select uid, replace(UID,'_00001','')
from tblPage inner join tbldoc on tblpage.id = tbldoc.id
Where srm_exportvolume='CQG121'

select uid ,substring(uid,0,len(uid)-charindex('.',reverse(uid))+1)+substring(uid,len(uid)-charindex('_',reverse(uid))+1,len(uid)-1)
--from tblPage
--INNER JOIN tblDoc on tblPage.id = tblDoc.id
--select uid, replace(UID,'_00001','')
from tblPage inner join tbldoc on tblpage.id = tbldoc.id
Where srm_exportvolume='CQG121'

-- Update begDoc /endDoc for docs with pgCount = 1 --------------
--update tblDoc
--set begDoc# = replace(begdoc#,'_00001',''), enddoc# = replace(enddoc#,'_00001','')
select begDoc#, endDoc# , begDoc# = replace(begdoc#,'_00001',''), enddoc# = replace(enddoc#,'_00001','')
from tblDoc
where srm_exportvolume='CQG121' and pgCount = 1

-- Update begDoc for the docs with pgCount >1 -----------

--update tblDoc
--set begDoc# = replace(begDoc#,'_00001','')
select begDoc#, begDoc# = replace(begDoc#,'_00001','')
from tblDoc
Where srm_exportvolume='CQG121' and pgCount<>1


-- Update UID -----------
--
--Update tblPage set UID = replace(UID,'_00001',''), dbo.tblDoc.PgCount
--from tblPage
--INNER JOIN tblDoc on tblPage.id = tblDoc.id
select uid, replace(UID,'_00001','')
from tblPage inner join tbldoc on tblpage.id = tbldoc.id
Where srm_exportvolume='CQG121'

select begDoc#, endDoc# , substring(begDoc#,0,len(begDoc#)-charindex('.',reverse(begDoc#))+1),
substring(endDoc#,0,len(endDoc#)-charindex('.',reverse(endDoc#))+1)+substring(endDoc#,len(endDoc#)-charindex('_',reverse(endDoc#))+1,len(endDoc#)-1)
from tblDoc
--update tblDoc
--set begDoc#=substring(begDoc#,0,len(begDoc#)-charindex('.',reverse(begDoc#))+1),
--endDoc#=substring(endDoc#,0,len(endDoc#)-charindex('.',reverse(endDoc#))+1)+substring(endDoc#,len(endDoc#)-charindex('_',reverse(endDoc#))+1,len(endDoc#)-1)
--begDoc# = replace(begdoc#,'_00001',''), enddoc# = replace(enddoc#,'_00001','')
where srm_exportvolume='CQG121'
--and pgCount = 1

-Update tblPage set UID = replace(UID,'_00001',''), dbo.tblDoc.PgCount
select uid ,substring(uid,0,len(uid)-charindex('.',reverse(uid))+1)+substring(uid,len(uid)-charindex('_',reverse(uid))+1,len(uid)-1)
--update tblPage set uid=substring(uid,0,len(uid)-charindex('.',reverse(uid))+1)+substring(uid,len(uid)-charindex('_',reverse(uid))+1,len(uid)-1)
--from tblPage
--INNER JOIN tblDoc on tblPage.id = tblDoc.id
--select uid, replace(UID,'_00001','')
from tblPage inner join tbldoc on tblpage.id = tbldoc.id
Where srm_exportvolume='CQG121'


Suffix starting on 2nd page notes..  Keep this will explain tomorrow

&[SRM_DOCID]_&[0000]&[0001]

-- Update begDoc /endDoc for docs with pgCount = 1 --------------
update tblDoc
set begDoc# = replace(begdoc#,'_0001',''), enddoc# = replace(enddoc#,'_0001','')
where SRM_Hit_Fam = 1

-- Update begDoc for the docs with pgCount >1 -----------

update tblDoc
set begDoc# = replace(begDoc#,'_0001','')
where SRM_Hit_Fam = 1


-- Update UID -----------

Update tblPage set UID = replace(UID,'_0001','')
from tblPage
INNER JOIN tblDoc on tblPage.id = tblDoc.id
where SRM_Hit_Fam = 1

select srm_source, srm_filepath
--update tbldoc set srm_source = replace(srm_source,'\\dr-cfs-data\eSource\IDM\IDM120\IDM120001\Hard Drives\','')
--update tbldoc set srm_filepath = replace(cast(srm_filepath as nvarchar(max)), 'S:\IDM\IDM120\IDM120023\' ,'')
from tbldoc d inner join tblEDSources s on d.EDSourceID = s.id
inner join tblfolders f on d.edfolderid = f.id
where [IDM120026_Step_1_4_Hit_fam] = 1

create table #tempsearch (id int, searchhit nvarchar(max))

bulk insert #tempsearch
from 'c:\IDM001_part3_SearchHit - Copy.txt'
with
(
fieldterminator = '|',
rowterminator = '\n'
)
go

select srm_searchhit from tbldoc d where [IDM120026_Step_1_4_Hit_fam] = 1
select srm_searchhit 
--inner join #tempsearch t on d.id = t.id
--update tbldoc set srm_searchhit = searchhit
from tbldoc d inner join #tempsearch t
on d.id = t.id
where [IDM120026_Step_1_4_Hit_fam] = 1



select [path], substring(sourcepath+left(sourcefilename, charindex('.',sourcefilename,0)-1), 56,len(sourcepath+left(sourcefilename, charindex('.',sourcefilename,0)-1))), f.name, srm_source, srm_filepath
--update tbldoc set srm_source = substring(sourcepath+left(sourcefilename, charindex('.',sourcefilename,0)-1), 56,len(sourcepath+left(sourcefilename, charindex('.',sourcefilename,0)-1)))
from tbldoc d inner join tbledsources s on d.edsourceid = s.id
inner join tblfolders f on d.EDFolderID = f.id
where [IDM120026_Step_1_4_Hit_fam] = 1
--where srm_source is not null

select count(*)
--update tbldoc set srm_source = sourcepath+left(sourcefilename, charindex('.',sourcefilename,0)-1)
--update tbldoc set srm_filepath = sourcepath+sourcefilename+'\'+name
from tbldoc d inner join tbledsources s on d.edsourceid = s.id
inner join tblfolders f on d.EDFolderID = f.id
where [IDM120026_Step_1_4_Hit_fam] = 1

